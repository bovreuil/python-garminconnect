#!/usr/bin/env python3
"""
Analyze heart rate data size and test JSON serialization
"""

import json
import sqlite3

# Sample heart rate data from the logs (first 100 points)
sample_hr_data = [
    [1751410800000, 94], [1751410920000, 83], [1751411040000, 67], [1751411160000, 65], [1751411280000, 64],
    [1751411400000, 63], [1751411520000, 63], [1751411640000, 63], [1751411760000, 63], [1751411880000, 77],
    [1751412000000, 72], [1751412120000, 67], [1751412240000, 62], [1751412360000, 62], [1751412480000, 62],
    [1751412600000, 62], [1751412720000, 60], [1751412840000, 62], [1751412960000, 60], [1751413080000, 60],
    [1751413200000, 61], [1751413320000, 60], [1751413440000, 59], [1751413560000, 60], [1751413680000, 60],
    [1751413800000, 60], [1751413920000, 59], [1751414040000, 60], [1751414160000, 65], [1751414280000, 73],
    [1751414400000, 58], [1751414520000, 59], [1751414640000, 59], [1751414760000, 59], [1751414880000, 59],
    [1751415000000, 59], [1751415120000, 58], [1751415240000, 59], [1751415360000, 59], [1751415480000, 60],
    [1751415600000, 64], [1751415720000, 70], [1751415840000, 63], [1751415960000, 64], [1751416080000, 65],
    [1751416200000, 63], [1751416320000, 64], [1751416440000, 63], [1751416560000, 63], [1751416680000, 63],
    [1751416800000, 63], [1751416920000, 64], [1751417040000, 64], [1751417160000, 64], [1751417280000, 64],
    [1751417400000, 64], [1751417520000, 64], [1751417640000, 64], [1751417760000, 64], [1751417880000, 66],
    [1751418000000, 63], [1751418120000, 63], [1751418240000, 64], [1751418360000, 64], [1751418480000, 63],
    [1751418600000, 64], [1751418720000, 64], [1751418840000, 63], [1751418960000, 63], [1751419080000, 63],
    [1751419200000, 63], [1751419320000, 63], [1751419440000, 62], [1751419560000, 62], [1751419680000, 62],
    [1751419800000, 62], [1751419920000, 63], [1751420040000, 63], [1751420160000, 63], [1751420280000, 61],
    [1751420400000, 65], [1751420520000, 60], [1751420640000, 62], [1751420760000, 62], [1751420880000, 61],
    [1751421000000, 62], [1751421120000, 63], [1751421240000, 62], [1751421360000, 64], [1751421480000, 63],
    [1751421600000, 64], [1751421720000, 63], [1751421840000, 62], [1751421960000, 63], [1751422080000, 63],
    [1751422200000, 62], [1751422320000, 62], [1751422440000, 62], [1751422560000, 62], [1751422680000, 63],
    [1751422800000, 62], [1751422920000, 62], [1751423040000, 62], [1751423160000, 62], [1751423280000, 62],
    [1751423400000, 62], [1751423520000, 63], [1751423640000, 63], [1751423760000, 63], [1751423880000, 63],
    [1751424000000, 63], [1751424120000, 63], [1751424240000, 63], [1751424360000, 63], [1751424480000, 63],
    [1751424600000, 62], [1751424720000, 62], [1751424840000, 62], [1751424960000, 62], [1751425080000, 62],
    [1751425200000, 62], [1751425320000, 62], [1751425440000, 62], [1751425560000, 65], [1751425680000, 61],
    [1751425800000, 60], [1751425920000, 60], [1751426040000, 60], [1751426160000, 60], [1751426280000, 60],
    [1751426400000, 59], [1751426520000, 62], [1751426640000, 61], [1751426760000, 62], [1751426880000, 68],
    [1751427000000, 66], [1751427120000, 72], [1751427240000, 74], [1751427360000, 81], [1751427480000, 73],
    [1751427600000, 71], [1751427720000, 62], [1751427840000, 59], [1751427960000, 60], [1751428080000, 59],
    [1751428200000, 58], [1751428320000, 59], [1751428440000, 58], [1751428560000, 57], [1751428680000, 58],
    [1751428800000, 59], [1751428920000, 60], [1751429040000, 59], [1751429160000, 58], [1751429280000, 59],
    [1751429400000, 58], [1751429520000, 57], [1751429640000, 57], [1751429760000, 58], [1751429880000, 59],
    [1751430000000, 58], [1751430120000, 59], [1751430240000, 58], [1751430360000, 58], [1751430480000, 58],
    [1751430600000, 58], [1751430720000, 59], [1751430840000, 58], [1751430960000, 59], [1751431080000, 56],
    [1751431200000, 57], [1751431320000, 62], [1751431440000, 61], [1751431560000, 60], [1751431680000, 59],
    [1751431800000, 59], [1751431920000, 59], [1751432040000, 59], [1751432160000, 59], [1751432280000, 58],
    [1751432400000, 60], [1751432520000, 57], [1751432640000, 56], [1751432760000, 57], [1751432880000, 57],
    [1751433000000, 59], [1751433120000, 60], [1751433240000, 55], [1751433360000, 55], [1751433480000, 55],
    [1751433600000, 55], [1751433720000, 56], [1751433840000, 54], [1751433960000, 55], [1751434080000, 55],
    [1751434200000, 55], [1751434320000, 54], [1751434440000, 54], [1751434560000, 55], [1751434680000, 55],
    [1751434800000, 55], [1751434920000, 56], [1751435040000, 56], [1751435160000, 55], [1751435280000, 56],
    [1751435400000, 56], [1751435520000, 57], [1751435640000, 57], [1751435760000, 56], [1751435880000, 56],
    [1751436000000, 57], [1751436120000, 56], [1751436240000, 57], [1751436360000, 56], [1751436480000, 57],
    [1751436600000, 56], [1751436720000, 56], [1751436840000, 56], [1751436960000, 57], [1751437080000, 57],
    [1751437200000, 57], [1751437320000, 57], [1751437440000, 59], [1751437560000, 58], [1751437680000, 58],
    [1751437800000, 58], [1751437920000, 58], [1751438040000, 58], [1751438160000, 57], [1751438280000, 57],
    [1751438400000, 57], [1751438520000, 57], [1751438640000, 57], [1751438760000, 57], [1751438880000, 56],
    [1751439000000, 57], [1751439120000, 57], [1751439240000, 56], [1751439360000, 57], [1751439480000, 56],
    [1751439600000, 56], [1751439720000, 56], [1751439840000, 57], [1751439960000, 61], [1751440080000, 58],
    [1751440200000, 59], [1751440320000, 65], [1751440440000, 65], [1751440560000, 62], [1751440680000, 78],
    [1751440800000, 79], [1751440920000, 79], [1751441040000, 57], [1751441160000, 54], [1751441280000, 54],
    [1751441400000, 54], [1751441520000, 57], [1751441640000, 53], [1751441760000, 54], [1751441880000, 55],
    [1751442000000, 59], [1751442120000, 57], [1751442240000, 57], [1751442360000, 58], [1751442480000, 58],
    [1751442600000, 65], [1751442720000, 58], [1751442840000, 58], [1751442960000, 57], [1751443080000, 58],
    [1751443200000, 60], [1751443320000, 58], [1751443440000, 58], [1751443560000, 58], [1751443680000, 64],
    [1751443800000, 80], [1751443920000, 64], [1751444040000, 62], [1751444160000, 65], [1751444280000, 65],
    [1751444400000, 65], [1751444520000, 64], [1751444640000, 64], [1751444760000, 63], [1751444880000, 63],
    [1751445000000, 63], [1751445120000, 65], [1751445240000, 63], [1751445360000, 68], [1751445480000, 81],
    [1751445600000, 67], [1751445720000, 75], [1751445840000, 77], [1751445960000, 77], [1751446080000, 65],
    [1751446200000, 63], [1751446320000, 61], [1751446440000, 60], [1751446560000, 59], [1751446680000, 60],
    [1751446800000, 61], [1751446920000, 59], [1751447040000, 58], [1751447160000, 59], [1751447280000, 61],
    [1751447400000, 77], [1751447520000, 87], [1751447640000, 94], [1751447760000, 84], [1751447880000, 81],
    [1751448000000, 80], [1751448120000, 75], [1751448240000, 65], [1751448360000, 70], [1751448480000, 77],
    [1751448600000, 72], [1751448720000, 71], [1751448840000, 77], [1751448960000, 75], [1751449080000, 93],
    [1751449200000, 93], [1751449320000, 97], [1751449440000, 84], [1751449560000, 81], [1751449680000, 69],
    [1751449800000, 68], [1751449920000, 66], [1751450040000, 72], [1751450160000, 83], [1751450280000, 76],
    [1751450400000, 70], [1751450520000, 73], [1751450640000, 71], [1751450760000, 73], [1751450880000, 68],
    [1751451000000, 67], [1751451120000, 68], [1751451240000, 68], [1751451360000, 70], [1751451480000, 77],
    [1751451600000, 78], [1751451720000, 80], [1751451840000, 79], [1751451960000, 77], [1751452080000, 76],
    [1751452200000, 77], [1751452320000, 77], [1751452440000, 81], [1751452560000, 81], [1751452680000, 79],
    [1751452800000, 82], [1751452920000, 78], [1751453040000, 75], [1751453160000, 81], [1751453280000, 93],
    [1751453400000, 88], [1751453520000, 90], [1751453640000, 91], [1751453760000, 90], [1751453880000, 87],
    [1751454000000, 85], [1751454120000, 92], [1751454240000, 95], [1751454360000, 107], [1751454480000, 102],
    [1751454600000, 91], [1751454720000, 94], [1751454840000, 93], [1751454960000, 92], [1751455080000, 90],
    [1751455200000, 91], [1751455320000, 110], [1751455440000, 100], [1751455560000, 102], [1751455680000, 105],
    [1751455800000, 101], [1751455920000, 98], [1751456040000, 101], [1751456160000, 108], [1751456280000, 113],
    [1751456400000, 101], [1751456520000, 111], [1751456640000, 109], [1751456760000, 100], [1751456880000, 90],
    [1751457000000, 85], [1751457120000, 94], [1751457240000, 77], [1751457360000, 74], [1751457480000, 75],
    [1751457600000, 73], [1751457720000, 74], [1751457840000, 72], [1751457960000, 72], [1751458080000, 71],
    [1751458200000, 70], [1751458320000, 70], [1751458440000, 69], [1751458560000, 68], [1751458680000, 68],
    [1751458800000, 67], [1751458920000, 68], [1751459040000, 68], [1751459160000, 66], [1751459280000, 66],
    [1751459400000, 65], [1751459520000, 66], [1751459640000, 65], [1751459760000, 66], [1751459880000, 63],
    [1751460000000, 67], [1751460120000, 68], [1751460240000, 69], [1751460360000, 68], [1751460480000, 67],
    [1751460600000, 66], [1751460720000, 66], [1751460840000, 65], [1751460960000, 65], [1751461080000, 63],
    [1751461200000, 63], [1751461320000, 71], [1751461440000, 64], [1751461560000, 65], [1751461680000, 63],
    [1751461800000, 62], [1751461920000, 63], [1751462040000, 65], [1751462160000, 64], [1751462280000, 62],
    [1751462400000, 63], [1751462520000, 63], [1751462640000, 64], [1751462760000, 62], [1751462880000, 68],
    [1751463000000, 81], [1751463120000, 74], [1751463240000, 66], [1751463360000, 63], [1751463480000, 65],
    [1751463600000, 67], [1751463720000, 60], [1751463840000, 64], [1751463960000, 69], [1751464080000, 67],
    [1751464200000, 61], [1751464320000, 63], [1751464440000, 62], [1751464560000, 62], [1751464680000, 61],
    [1751464800000, 63], [1751464920000, 64], [1751465040000, 63], [1751465160000, 64], [1751465280000, 62],
    [1751465400000, 63], [1751465520000, 63], [1751465640000, 64], [1751465760000, 69], [1751465880000, 62],
    [1751466000000, 62], [1751466120000, 74], [1751466240000, 66], [1751466360000, 68], [1751466480000, 66],
    [1751466600000, 66], [1751466720000, 63], [1751466840000, 64], [1751466960000, 63], [1751467080000, 71],
    [1751467200000, 69], [1751467320000, 66], [1751467440000, 67], [1751467560000, 63], [1751467680000, 63],
    [1751467800000, 64], [1751467920000, 64], [1751468040000, 62], [1751468160000, 68], [1751468280000, 70],
    [1751468400000, 67], [1751468520000, 62], [1751468640000, 63], [1751468760000, 61], [1751468880000, 62],
    [1751469000000, 65], [1751469120000, 64], [1751469240000, 64], [1751469360000, 63], [1751469480000, 64],
    [1751469600000, 65], [1751469720000, 62], [1751469840000, 62], [1751469960000, 64], [1751470080000, 62],
    [1751470200000, 64], [1751470320000, 64], [1751470440000, 66], [1751470560000, 63], [1751470680000, 65],
    [1751470800000, 63], [1751470920000, 64], [1751471040000, 62], [1751471160000, 62], [1751471280000, 63],
    [1751471400000, 63], [1751471520000, 67], [1751471640000, 67], [1751471760000, 65], [1751471880000, 70],
    [1751472000000, 67], [1751472120000, 64], [1751472240000, 65], [1751472360000, 66], [1751472480000, 64],
    [1751472600000, 63], [1751472720000, 64], [1751472840000, 63], [1751472960000, 64], [1751473080000, 62],
    [1751473200000, 63], [1751473320000, 63], [1751473440000, 62], [1751473560000, 63], [1751473680000, 63],
    [1751473800000, 63], [1751473920000, 64], [1751474040000, 63], [1751474160000, 63], [1751474280000, 65],
    [1751474400000, 63], [1751474520000, 62], [1751474640000, 63], [1751474760000, 64], [1751474880000, 63],
    [1751475000000, 64], [1751475120000, 67], [1751475240000, 66], [1751475360000, 63], [1751475480000, 62],
    [1751475600000, 63], [1751475720000, 62], [1751475840000, 62], [1751475960000, 62], [1751476080000, 62],
    [1751476200000, 64], [1751476320000, 63], [1751476440000, 62], [1751476560000, 72], [1751476680000, 65],
    [1751476800000, 63], [1751476920000, 69], [1751477040000, 64], [1751477160000, 64], [1751477280000, 67],
    [1751477400000, 69], [1751477520000, 65], [1751477640000, 73], [1751477760000, 63], [1751477880000, 66],
    [1751478000000, 63], [1751478120000, 62], [1751478240000, 63], [1751478360000, 64], [1751478480000, 65],
    [1751478600000, 62], [1751478720000, 66], [1751478840000, 65], [1751478960000, 64], [1751479080000, 77],
    [1751479200000, 72], [1751479320000, 65], [1751479440000, 69], [1751479560000, 64], [1751479680000, 64],
    [1751479800000, 64], [1751479920000, 64], [1751480040000, 64], [1751480160000, 65], [1751480280000, 69],
    [1751480400000, 65], [1751480520000, 65], [1751480640000, 64], [1751480760000, 63], [1751480880000, 65],
    [1751481000000, 64], [1751481120000, 64], [1751481240000, 65], [1751481360000, 64], [1751481480000, 65],
    [1751481600000, 67], [1751481720000, 64], [1751481840000, 67], [1751481960000, 69], [1751482080000, 85],
    [1751482200000, 69], [1751482320000, 82], [1751482440000, 78], [1751482560000, 77], [1751482680000, 81],
    [1751482800000, 91], [1751482920000, 101], [1751483040000, 108], [1751483160000, 105], [1751483280000, 102],
    [1751483400000, 107], [1751483520000, 107], [1751483640000, 111], [1751483760000, 107], [1751483880000, 108],
    [1751484000000, 104], [1751484120000, 104], [1751484240000, 102], [1751484360000, 101], [1751484480000, 102],
    [1751484600000, 97], [1751484720000, 90], [1751484840000, 94], [1751484960000, 93], [1751485080000, 95],
    [1751485200000, 95], [1751485320000, 96], [1751485440000, 95], [1751485560000, 95], [1751485680000, 100],
    [1751485800000, 101], [1751485920000, 93], [1751486040000, 97], [1751486160000, 92], [1751486280000, 98],
    [1751486400000, 101], [1751486520000, 99], [1751486640000, 98], [1751486760000, 87], [1751486880000, 86],
    [1751487000000, 83], [1751487120000, 75], [1751487240000, 75], [1751487360000, 75], [1751487480000, 78],
    [1751487600000, 76], [1751487720000, 74], [1751487840000, 75], [1751487960000, 75], [1751488080000, 74],
    [1751488200000, 71], [1751488320000, 74], [1751488440000, 75], [1751488560000, 69], [1751488680000, 78],
    [1751488800000, 88], [1751488920000, 101], [1751489040000, 89], [1751489160000, 83], [1751489280000, 79],
    [1751489400000, 79], [1751489520000, 80], [1751489640000, 80], [1751489760000, 77], [1751489880000, 80],
    [1751490000000, 79], [1751490120000, 75], [1751490240000, 77], [1751490360000, 74], [1751490480000, 75],
    [1751490600000, 77], [1751490720000, 74], [1751490840000, 76], [1751490960000, 78], [1751491080000, 75],
    [1751491200000, 75], [1751491320000, 80], [1751491440000, 77], [1751491560000, 71], [1751491680000, 73],
    [1751491800000, 73], [1751491920000, 71], [1751492040000, 78], [1751492160000, 75], [1751492280000, 78],
    [1751492400000, 74], [1751492520000, 73], [1751492640000, 72], [1751492760000, 75], [1751492880000, 80],
    [1751493000000, 72], [1751493120000, 70], [1751493240000, 73], [1751493360000, 75], [1751493480000, 70],
    [1751493600000, 69]
]

def analyze_data():
    print("=== Heart Rate Data Analysis ===")
    
    # Count data points
    num_points = len(sample_hr_data)
    print(f"Number of data points: {num_points}")
    
    # Calculate JSON size
    json_str = json.dumps(sample_hr_data)
    json_size = len(json_str)
    print(f"JSON string size: {json_size:,} bytes ({json_size/1024:.1f} KB)")
    
    # Analyze data structure
    if num_points > 0:
        first_point = sample_hr_data[0]
        timestamp_size = len(str(first_point[0]))
        hr_size = len(str(first_point[1]))
        print(f"Timestamp size: {timestamp_size} digits")
        print(f"Heart rate size: {hr_size} digits")
        print(f"Average point size: {json_size/num_points:.1f} bytes per point")
    
    # Test database insert
    print("\n=== Testing Database Insert ===")
    try:
        conn = sqlite3.connect('garmin_hr.db')
        cur = conn.cursor()
        
        # Test insert with sample data
        cur.execute("""
            UPDATE heart_rate_data 
            SET raw_hr_data = ? 
            WHERE date = '2025-07-02'
        """, (json_str,))
        
        conn.commit()
        
        # Verify the insert
        cur.execute("""
            SELECT LENGTH(raw_hr_data) as size, raw_hr_data IS NOT NULL as not_null
            FROM heart_rate_data 
            WHERE date = '2025-07-02'
        """)
        
        result = cur.fetchone()
        if result:
            size, not_null = result
            print(f"Database insert successful!")
            print(f"Stored size: {size:,} bytes")
            print(f"Is not null: {not_null}")
        else:
            print("No record found for 2025-07-02")
        
        cur.close()
        conn.close()
        
    except Exception as e:
        print(f"Database insert failed: {e}")

if __name__ == '__main__':
    analyze_data() 